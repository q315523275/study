{"version":3,"file":"p__message-manage__information-publish__models__add.js.6262f4dd.async.js","sources":["src/pages/message-manage/information-publish/models/add.js"],"sourcesContent":["import { message } from 'antd'\nimport router from 'umi/router'\nimport { \n  getAdd, \n  getModulesList,\n  getItemsList,\n  getUniversity,\n  getSubject,\n  getUniversitySubject,\n  getUniversityCase,\n  getSummerProject,\n  getBackground\n } from '../api'\n\nexport default {\n  namespace: 'informationPublishAdd',\n  state: {\n    modulesList: [],\n    itemsList: [],\n    resourceList: [],\n    chooseType:'',\n\n    listData:[],\n    pagination:{}\n\n  },\n  effects: {\n    * getModulesList({ params }, { call, put }) {\n      const modulesList = yield call(getModulesList, params)\n      yield put({\n        type: 'save',\n        payload: {\n          modulesList,\n        },\n      })\n    },\n\n    * getItemsList({ params,chooseType }, { call, put }) {\n      const itemsList = yield call(getItemsList, params)\n      yield put({\n        type: 'save',\n        payload: {\n          itemsList,\n          resourceList: [],\n          chooseType\n        },\n      })\n    },\n\n    // 获取记录数据\n    * getResource({ params }, { call, put,select }) {\n      const {chooseType} = yield select(({ informationPublishAdd }) => ({ ...informationPublishAdd }))\n      console.log(chooseType)\n      const waysJson = {\n        university: ()=>  call(getUniversity, params),\n        subject: ()=> call(getSubject, params),\n        universitySubject: ()=> call(getUniversitySubject, params),\n        universityCase: ()=> call(getUniversityCase, params),\n        summerProject:  ()=> call(getSummerProject, params),\n        background: ()=> call(getBackground, params),\n      }\n      const res = yield waysJson[chooseType]()\n      const {\n        data, total, pageNumber, pageSize,\n      } = res\n      delete params.pageNumber\n      delete params.pageSize\n      yield put({\n        type: 'save',\n        payload: {\n          listData: data || [],\n          pagination: {\n            current: pageNumber,\n            pageSize,\n            total,\n            showTotal: sum => `共 ${sum} 项`,\n          },\n          query: {\n            ...params,\n          },\n        },\n      })\n    },\n    // 新增\n    * getAdd({ params }, { call, put }) {\n      const res = yield call(getAdd, params)\n      console.log(res)\n      if (res.success) {\n        message.success('操作成功')\n        router.push('/message-manage/information-publish')\n      } else {\n        message.error('操作失败')\n      }\n    },\n\n\n  },\n  reducers: {\n    save(state, { payload }) {\n      return {\n        ...state,\n        ...payload,\n      }\n    },\n  },\n}\n"],"mappings":"AAcA","sourceRoot":""}